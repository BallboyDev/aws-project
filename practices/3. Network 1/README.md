# Network
- AWS 네트워킹 서비스는 AWS 글로벌 인프라에서 생성된 다양한 자원의 워크로드를 수행하는 네트워킹 서비스이다.

## AWS 네트워크

### AWS 리전 네트워킹 디자인
- 리전은 전 세계 주요 도시의 데이터 센터를 군집화하는 물리적인 위치를 의미한다. AWS 리전 내부에는 트랜짓 센터와 가용 영역이 서로 연결되어 네트워크 환경을 이루고 있으며, 네트워킹 측면으로 어떤 대상과 연결되었는지에 따라 분류할 수 있다.

- Intra-AZ 연결
    - 동일한 가용 영역 내에 있는 리소스(EC2 인스턴스) 간의 통신
    - 같은 데이터 센터 내에 있으므로 네트워크 지연 시간이 매우 짧으며 동일 AZ(가용 영역, Availability Zone) 내에서의 데이터 전송에는 비용이 부과되지 않는다.

- Inter-AZ 연결
    - 동일한 AWS 리전 내의 서로 다른 가용 영역 간의 통신
    - AWS의 고대역폭, 이중화된 전용 네트워크를 통해 연결되어 지연시간이 낮다.
    - 모든 Inter-AZ 트래픽은 전송 중에 자동으로 암호화 되며, 여러 AZ에 걸쳐 애플리케이션을 분산 배포하여 하나의 AZ에 장애가 발생하더라도 서비스 연속성을 확보할 수 있다.
    - AZ 간 데이터 전송에는 GB당 약간의 비용이 부과된다.

- 트랜짓 센터 연결 (AWS Transit Gateway)
    - 다수의 VCP(Virtual Private Cloud)와 온프레이미스 네트워크를 중앙에서 단일 게이트웨이를 통해 연결하는 서비스로 복잡한 네트워크를 허브엔 스포크 모델로 단순화 한다.
    - 수많은 VPC 피어링 연결을 관리할 필요 없이, 중앙 허브인 Transit Gatway에 연결하기만 하면 되므로 관리가 간편해진다.
    - 라우팅 및 보안 정책을 중앙에서 관리하여 일관성을 유지하고 운영을 효율화할 수 있다.
    - 수천개의 VPC와 온프레미스 연결을 지원하여 네트워크가 성장함에 따라 쉽게 확장할 수 있으며, 다른 AWS 리전의 트랜짓 게이트웨이와도 연결할 수 있어 글로벌 네트워크를 쉽게 구축할 수 있다.

### AWS 글로벌 네트워크와 엣지 POP
-  AWS 엣지 POP
    - 엣지 POP는 AWS의 글로벌 인프라 중 하나로, 최종 사용자와 가장 가까운 곳에 위치한 데이터 센터 네트워크로 지연 시간의 최소화와 콘턴츠 전송 속도 향상을 목적으로 한다.
    - 엣지 POP는 트래픽을 AWS 백본 (전용 네트워크 통신선) 통해 빠르고 안정적인 통신을 지원하거나 이전에 호출되어 캐시에 저장되어 있는 컨텐츠 (이미지, 데이터 등)를 빠르게 제공하는 역할을 한다.

## AWS 네트워크 서비스
- 네트워크 기반
    - VPC
        - 사용자 전용의 가상 프라이빗 클라우드 네트워크로, 네트워크 자원을 탄력적으로 활용하는 서비스 제공
    - Transit Gateway
        - 중앙 허브 개념과 같이 VPC와 온프레미스 네트워크를 연결하는 게이트웨이 역할의 서비스 제공

- 엣지 네트워킹
    - Route 53
        - AWS에서 제공하는 관리형 DNS 서비스로 도메인 등록, 라우팅, 상태 확인 등의 서비스 제공
    - Global Accelerator
        - AWS 글로벌 네트워크를 통해 애플리케이션을 빠르고 안정적으로 사용할 수 있도록 가용성 및 성능을 보장하는 서비스 제공

- 하이브리드 연결
    - Direct Connect
        - 온프레미스 환경에서 AWS와 전용 네트워크 연결 서비스 제공
    - Site-to-Site VPN
        - IPsec VPN 연결을 생성하여 암호화된 네트워크를 구성하는 서비스 제공

## Amazon VPC
- 사용자 정의로 구성된 가상의 프라이빗 클라우드 네트워크로 Amazon VPC에서 제공하는 다양한 네트워킹 요소를 이용하여 가상의 클라우드 네트워크를 구성할 수 있다.
- Amazon VPC는 리전마다 독립적으로 구성되어 있으며, 리전 내에는 다수의 VPC를 생성할 수 있다.

### 1. VPC
- AWS 클라우드 내에 논리적으로 격리된 나만의 가상 네트워크 공간

### 2. Subnet
- VPC라는 큰 네트워크 공간을 잘게 나눈 하위 네트워크 영역으로, 각 서브넷은 특정 가용 영역 안에 만들어져 서브넷에 장애가 발생해도 다른 섭넷에는 영향이 없다.
- 퍼블릭 서브넷
    - 인터넷과 직접 통신할 수 있는 서브넷. 주로 웹 서버, 로드 밸런서 등 외부 사용자의 접근이 필요한 리소스를 배치한다.
- 프라이빗 서브넷
    - 인터넷에서 직접 접근할 수 없는 폐쇄적인 서브넷. 주로 데이터베이스, 내부 애플리케이션 서버 등 보안이 중요한 리소스를 배치

### 3. Route Table
- 서브넷에서 발생하는 네트워크 트래픽이 어디로 가야 할지를 알려주는 지도 역할로 각 서브넷은 반드시 하나의 라우팅 테이블과 연결되어야 한다.
- 목적지 대상
    - 네트워크 트래픽이 최종적으로 도달하고자 하는 '주소의 범위'를 의미
- 타깃 대상
    - 목적지 대상에서 지정한 목적지로 트래픽을 전달하기 위해 거쳐야할 리소스(게이트 웨이, 구역 등)를 의미

### 4. Internet Gateway
- VPC와 인터넷 간의 통신을 가능하게 하는 관문으로 퍼블릭 서브넷의 리소스가 인터넷에 연결되기 위해서 필요하다.

### 5. Nat Gateway
- 프라이빗 서브넷에 있는 리소스가 인터넷으로 나가는 통신(out bound)은 허용하지만 인터넷에서 직접 들어오는 통신 (in bound)은 차단하는 역할을 한다.

### 6. 보안 그룹
- EC2 인스턴스 단위로 적용되는 '가상 방화벽'. 어떤 IP와 포트의 트래픽을 허용할지 규칙을 설정한다.
- 상태 기반(stateful)이므로, 허용한 인바운드 트래픽에 대한 응답은 별도 규칙없이 자동으로 허용한다.

### 7. 네트워크 ACL
- 서브넷 단위로 적용되는 '가상 방화벽'. 서브넷으로 들어오고 나가는 모든 트래픽에 대한 허용/거부 규칙을 설정
- 상태 비저장(stateless)이므로, 인바운드와 아웃바운드 규칙을 각각 설정해 주어야 한다.


## VPC 구성
~~~
// VPC를 이용한 웹 인프라 구축

인터넷/사용자
┃
IGW (인터넷 게이트웨이)
[10.3.0.0/16]
┃
가상 라우터
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
[public subnet]                    [private subnet]
[10.3.1.0/24]                      [10.3.2.0/24]
┣━━━━━━━━━━━━━━━━━┓                ┃
Public Router     Nat Gateway      private Router
┃                                  ┃
Secret Group                       Secret Group
┃                                  ┃
public EC2                         public EC2
~~~

- Public Routing Table
    ||목적지|타깃|
    |:-:|:-:|:-:|
    |1|10.3.0.0.16|local|
    |2|0.0.0.0/0|igw-xxxx|

- private Routing Table
    ||목적지|타깃|
    |:-:|:-:|:-:|
    |1|10.3.0.0.16|local|
    |2|0.0.0.0/0|nat-xxxx|
